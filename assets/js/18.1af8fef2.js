(window.webpackJsonp=window.webpackJsonp||[]).push([[18],{429:function(t,a,s){"use strict";s.r(a);var r=s(2),v=Object(r.a)({},(function(){var t=this,a=t._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h2",{attrs:{id:"联系人"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#联系人"}},[t._v("#")]),t._v(" 联系人")]),t._v(" "),a("h3",{attrs:{id:"批量校验查看是否是自己好友"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#批量校验查看是否是自己好友"}},[t._v("#")]),t._v(" 批量校验查看是否是自己好友")]),t._v(" "),a("p",[t._v("点击用户头像加好友，需要先判断是不是自己的好友。用该接口")]),t._v(" "),a("h3",{attrs:{id:"申请好友"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#申请好友"}},[t._v("#")]),t._v(" 申请好友")]),t._v(" "),a("p",[t._v("点击头像发起申请，填写申请信息。会有一个ws推送给对方")]),t._v(" "),a("h3",{attrs:{id:"删除好友"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#删除好友"}},[t._v("#")]),t._v(" 删除好友")]),t._v(" "),a("p",[t._v("调用接口删除好友")]),t._v(" "),a("h3",{attrs:{id:"申请列表"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#申请列表"}},[t._v("#")]),t._v(" 申请列表")]),t._v(" "),a("p",[t._v("根据创建时间，普通分页。只能接受，不能拒绝")]),t._v(" "),a("p",[t._v("只给uid，信息自己获取。展示申请信息。")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://vuepress-starter.oss-cn-shenzhen.aliyuncs.com/mallchat/2023/09/02/%E5%8D%95%E8%81%8A%E7%BE%A4%E8%81%8A%E6%8A%80%E6%9C%AF%E6%96%B9%E6%A1%88/%E7%94%B3%E8%AF%B7%E5%88%97%E8%A1%A8.png",alt:""}})]),t._v(" "),a("h3",{attrs:{id:"记录未读数"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#记录未读数"}},[t._v("#")]),t._v(" 记录未读数")]),t._v(" "),a("img",{staticStyle:{zoom:"50%"},attrs:{src:"https://vuepress-starter.oss-cn-shenzhen.aliyuncs.com/mallchat/2023/09/02/%E5%8D%95%E8%81%8A%E7%BE%A4%E8%81%8A%E6%8A%80%E6%9C%AF%E6%96%B9%E6%A1%88/%E8%AE%B0%E5%BD%95%E6%9C%AA%E8%AF%BB%E6%95%B01.png"}}),t._v(" "),a("img",{staticStyle:{zoom:"67%"},attrs:{src:"https://vuepress-starter.oss-cn-shenzhen.aliyuncs.com/mallchat/2023/09/02/%E5%8D%95%E8%81%8A%E7%BE%A4%E8%81%8A%E6%8A%80%E6%9C%AF%E6%96%B9%E6%A1%88/%E8%AE%B0%E5%BD%95%E6%9C%AA%E8%AF%BB%E6%95%B02.png"}}),t._v(" "),a("h3",{attrs:{id:"计算好友会话接口"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#计算好友会话接口"}},[t._v("#")]),t._v(" 计算好友会话接口")]),t._v(" "),a("p",[t._v("根据uid从后端拿会话")]),t._v(" "),a("h3",{attrs:{id:"同意好友申请-不需要拒绝-冷处理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#同意好友申请-不需要拒绝-冷处理"}},[t._v("#")]),t._v(" 同意好友申请（不需要拒绝，冷处理）")]),t._v(" "),a("p",[t._v("同时给该用户，添加对于好友的会话。")]),t._v(" "),a("p",[t._v("后台会推送一条新消息（同意了好友申请）")]),t._v(" "),a("h3",{attrs:{id:"联系人列表-支持游标翻页"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#联系人列表-支持游标翻页"}},[t._v("#")]),t._v(" 联系人列表（支持游标翻页）")]),t._v(" "),a("p",[t._v("可简单展示，直接翻页")]),t._v(" "),a("p",[t._v("发消息可定位发送（暂时不做）")]),t._v(" "),a("p",[t._v("会有新消息触发，推送给两个人。如果这时候没有roomId，要去后端加载会话信息。")]),t._v(" "),a("h2",{attrs:{id:"会话列表"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#会话列表"}},[t._v("#")]),t._v(" 会话列表")]),t._v(" "),a("img",{staticStyle:{zoom:"50%"},attrs:{src:"https://vuepress-starter.oss-cn-shenzhen.aliyuncs.com/mallchat/2023/09/02/%E5%8D%95%E8%81%8A%E7%BE%A4%E8%81%8A%E6%8A%80%E6%9C%AF%E6%96%B9%E6%A1%88/%E4%BC%9A%E8%AF%9D%E5%88%97%E8%A1%A82.png"}}),t._v(" "),a("h3",{attrs:{id:"会话列表-有未读数-根据时间线游标翻页"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#会话列表-有未读数-根据时间线游标翻页"}},[t._v("#")]),t._v(" 会话列表（有未读数，根据时间线游标翻页）")]),t._v(" "),a("p",[a("code",[t._v("/capi/chat/public/contact/page")])]),t._v(" "),a("p",[t._v("返回的是房间id，单聊群聊都有一个房间id。")]),t._v(" "),a("p",[t._v("除了第一次加载。后续每次有新消息，都要更新会话列表的"),a("code",[t._v("activeTime")]),t._v("，如果该会话不在当前房间内，还需要更新未读数。"),a("code",[t._v("unreadCount")]),t._v("+1.`")]),t._v(" "),a("img",{staticStyle:{zoom:"50%"},attrs:{src:"https://vuepress-starter.oss-cn-shenzhen.aliyuncs.com/mallchat/2023/09/02/%E5%8D%95%E8%81%8A%E7%BE%A4%E8%81%8A%E6%8A%80%E6%9C%AF%E6%96%B9%E6%A1%88/%E4%BC%9A%E8%AF%9D%E5%88%97%E8%A1%A81.png"}}),t._v(" "),a("h3",{attrs:{id:"会话详情"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#会话详情"}},[t._v("#")]),t._v(" 会话详情")]),t._v(" "),a("p",[t._v("有些消息推送给用户，用户会话列表没有该消息的会话。可以查详情 "),a("code",[t._v("/capi/chat/public/contact/detail")])]),t._v(" "),a("p",[t._v("会话未读点进去。如果未读超过一页，加载不完，需要展示新消息跳转图标，去后端加载（优先级低）")]),t._v(" "),a("img",{staticStyle:{zoom:"80%"},attrs:{src:"https://vuepress-starter.oss-cn-shenzhen.aliyuncs.com/mallchat/2023/09/02/%E5%8D%95%E8%81%8A%E7%BE%A4%E8%81%8A%E6%8A%80%E6%9C%AF%E6%96%B9%E6%A1%88/%E4%BC%9A%E8%AF%9D%E8%AF%A6%E6%83%85.png"}}),t._v(" "),a("h3",{attrs:{id:"消息已读未读列表"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#消息已读未读列表"}},[t._v("#")]),t._v(" 消息已读未读列表")]),t._v(" "),a("p",[t._v("查询消息的已读或者未读用户列表，游标翻页 "),a("code",[t._v("/capi/chat/msg/read/page")])]),t._v(" "),a("h3",{attrs:{id:"消息已读未读数"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#消息已读未读数"}},[t._v("#")]),t._v(" 消息已读未读数")]),t._v(" "),a("p",[t._v("自己发送的消息，可以查看已读未读数和已读未读列表。")]),t._v(" "),a("p",[t._v("自己发送消息后，前端加个定时任务，5分钟内每10s中查询一次已读数。")]),t._v(" "),a("p",[t._v("用户点开列表的时候，再加载未读数。")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://vuepress-starter.oss-cn-shenzhen.aliyuncs.com/mallchat/2023/09/02/%E5%8D%95%E8%81%8A%E7%BE%A4%E8%81%8A%E6%8A%80%E6%9C%AF%E6%96%B9%E6%A1%88/%E6%B6%88%E6%81%AF%E5%B7%B2%E8%AF%BB%E6%9C%AA%E8%AF%BB%E6%95%B0.png",alt:""}})]),t._v(" "),a("p",[t._v("获取消息列表，消息列表是自己的消息，来后端批量获取已读数。")]),t._v(" "),a("p",[t._v("如果点进去查看")]),t._v(" "),a("p",[t._v("1.去后端获取消息未读数")]),t._v(" "),a("p",[t._v("2.获取一个已读或未读的列表。")]),t._v(" "),a("p",[t._v("新消息发送完毕后。")]),t._v(" "),a("p",[t._v("当前会话会启动一个定时器。每30s查出当前屏幕内的自己的消息。调用后端获取消息已读数，进行更新。超过两天的消息定时器就不跑了。")]),t._v(" "),a("h3",{attrs:{id:"已读上报"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#已读上报"}},[t._v("#")]),t._v(" 已读上报")]),t._v(" "),a("p",[t._v("用户在某个房间获取了新消息，需要上报最新阅读状态。如果用户新打开某个房间看了新消息，也需要上报阅读状态。每次有消息推送，用户查看了，也要上报阅读状态。")]),t._v(" "),a("p",[a("code",[t._v("/capi/chat/msg/read")])]),t._v(" "),a("p",[t._v("上报时间点：")]),t._v(" "),a("p",[t._v("1.用户首次进入会话，加载完了消息，触发上报")]),t._v(" "),a("p",[t._v("2.在"),a("strong",[t._v("当前会话内")]),t._v("的每条新消息，接收到之后，进行上报。")]),t._v(" "),a("h2",{attrs:{id:"群组管理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#群组管理"}},[t._v("#")]),t._v(" 群组管理")]),t._v(" "),a("h3",{attrs:{id:"好友详情"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#好友详情"}},[t._v("#")]),t._v(" 好友详情")]),t._v(" "),a("p",[t._v("根据详情判断能否发消息。")]),t._v(" "),a("h3",{attrs:{id:"群详情信息"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#群详情信息"}},[t._v("#")]),t._v(" 群详情信息")]),t._v(" "),a("p",[t._v("返回群的基本信息，在线人数，用户角色（关系到踢人和撤回）返回4代表用户已被移除群")]),t._v(" "),a("p",[t._v("废除"),a("code",[t._v("/capi/chatpublic/member/statistic")]),t._v(" 新接口："),a("code",[t._v("/capi/room/public/group")])]),t._v(" "),a("h3",{attrs:{id:"创建群聊"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#创建群聊"}},[t._v("#")]),t._v(" 创建群聊")]),t._v(" "),a("img",{staticStyle:{zoom:"80%"},attrs:{src:"https://vuepress-starter.oss-cn-shenzhen.aliyuncs.com/mallchat/2023/09/02/%E5%8D%95%E8%81%8A%E7%BE%A4%E8%81%8A%E6%8A%80%E6%9C%AF%E6%96%B9%E6%A1%88/%E5%88%9B%E5%BB%BA%E7%BE%A4%E8%81%8A.png"}}),t._v(" "),a("p",[t._v("选择了人自动成群。")]),t._v(" "),a("p",[t._v("创建成功后，返回roomId。同时后端会有一条系统消息，推送所有群成员。谁邀请了谁加入群聊。")]),t._v(" "),a("p",[t._v("系统消息有roomId。")]),t._v(" "),a("h3",{attrs:{id:"群成员列表"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#群成员列表"}},[t._v("#")]),t._v(" 群成员列表")]),t._v(" "),a("p",[a("code",[t._v("/capi/room/public/group/member/page")])]),t._v(" "),a("h3",{attrs:{id:"艾特人员列表"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#艾特人员列表"}},[t._v("#")]),t._v(" 艾特人员列表")]),t._v(" "),a("p",[a("code",[t._v("/capi/room/group/member/list")])]),t._v(" "),a("h3",{attrs:{id:"踢出群成员"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#踢出群成员"}},[t._v("#")]),t._v(" 踢出群成员")]),t._v(" "),a("p",[a("code",[t._v("/capi/room/group/member")])]),t._v(" "),a("p",[t._v("踢出群成员。权限校验，要么是群级别的管理员等，要么是全局的管理角色。")]),t._v(" "),a("p",[t._v("用户角色来自于群详情信息")]),t._v(" "),a("h3",{attrs:{id:"自己退群"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#自己退群"}},[t._v("#")]),t._v(" 自己退群")]),t._v(" "),a("p",[t._v("暂不开放")]),t._v(" "),a("h3",{attrs:{id:"邀请新成员加入"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#邀请新成员加入"}},[t._v("#")]),t._v(" 邀请新成员加入")]),t._v(" "),a("p",[a("code",[t._v("/capi/room/group/member post")])]),t._v(" "),a("p",[t._v("前端：根据"),a("strong",[t._v("群成员的艾特列表")]),t._v("拿到的uid，和邀请界面的好友列表做去重判断。")]),t._v(" "),a("p",[t._v("校验自己是这个群的用户，校验邀请的都是自己好友。")]),t._v(" "),a("p",[t._v("新加入的成员，后端会给ws推送")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://vuepress-starter.oss-cn-shenzhen.aliyuncs.com/mallchat/2023/09/02/%E5%8D%95%E8%81%8A%E7%BE%A4%E8%81%8A%E6%8A%80%E6%9C%AF%E6%96%B9%E6%A1%88/%E9%82%80%E8%AF%B7%E6%96%B0%E6%88%90%E5%91%98%E5%8A%A0%E5%85%A5.png",alt:""}})]),t._v(" "),a("h2",{attrs:{id:"ws推送"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ws推送"}},[t._v("#")]),t._v(" ws推送")]),t._v(" "),a("h3",{attrs:{id:"申请推送"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#申请推送"}},[t._v("#")]),t._v(" 申请推送")]),t._v(" "),a("p",[t._v("只需要给前端推送当前的未读数就够了，用户自己点进去的时候看待处理的。")]),t._v(" "),a("p",[a("code",[t._v("com.abin.mallchat.custom.user.domain.vo.response.ws.WSFriendApply")])]),t._v(" "),a("p",[a("img",{attrs:{src:"https://vuepress-starter.oss-cn-shenzhen.aliyuncs.com/mallchat/2023/09/02/%E5%8D%95%E8%81%8A%E7%BE%A4%E8%81%8A%E6%8A%80%E6%9C%AF%E6%96%B9%E6%A1%88/%E7%94%B3%E8%AF%B7%E6%8E%A8%E9%80%81.png",alt:""}})]),t._v(" "),a("p",[t._v("type=10")]),t._v(" "),a("h3",{attrs:{id:"群成员变动"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#群成员变动"}},[t._v("#")]),t._v(" 群成员变动")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://vuepress-starter.oss-cn-shenzhen.aliyuncs.com/mallchat/2023/09/02/%E5%8D%95%E8%81%8A%E7%BE%A4%E8%81%8A%E6%8A%80%E6%9C%AF%E6%96%B9%E6%A1%88/%E7%BE%A4%E6%88%90%E5%91%98%E5%8F%98%E5%8A%A8.png",alt:""}})]),t._v(" "),a("p",[t._v("新"),a("code",[t._v("com.abin.mallchat.custom.user.domain.vo.response.ws.WSMemberChange")]),t._v("  type=11")])])}),[],!1,null,null,null);a.default=v.exports}}]);